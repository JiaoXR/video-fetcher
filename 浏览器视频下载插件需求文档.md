# 🧩 浏览器视频下载插件需求文档

## 一、项目概述

### 1.1 项目名称

**VideoGrabber** —— 一款浏览器端视频下载插件。

### 1.2 项目目标

提供一个简洁高效的浏览器插件，自动检测网页中的视频资源（如 MP4、M3U8 等），支持用户一键下载或复制资源链接，提升用户获取在线视频资源的便捷性。

### 1.3 支持浏览器

* Chrome
* Edge (Chromium 内核)
* Firefox (后续支持)

---

## 二、主要功能需求

### 2.1 视频检测

* 自动识别网页中的视频资源（包括但不限于以下类型）：

  * `<video>` 标签中的源文件（`src`、`source`）
  * 网络请求中的视频流文件（`.mp4`, `.webm`, `.mkv`, `.m3u8`）
  * AJAX / XHR / fetch 请求中返回的视频流
* 通过插件图标状态反馈检测结果（灰色=未检测，亮色=检测到视频）。

### 2.2 视频列表展示

* 点击插件图标弹出一个面板，列出所有检测到的视频资源：

  * 显示视频名称 / URL（可截断显示）
  * 显示视频大小（若可获取）
  * 显示视频格式（根据文件扩展名或 Content-Type 判断）
  * 提供预览按钮（可选）

### 2.3 下载与复制

* 每个视频条目提供：

  * 「下载」按钮 → 直接下载文件
  * 「复制链接」按钮 → 复制视频直链到剪贴板
* 支持右键菜单快速操作：

  * “下载本页视频”
  * “复制视频链接”

### 2.4 高级功能（可选扩展）

| 功能         | 描述                          |
| ---------- | --------------------------- |
| **多分辨率检测** | 对支持多清晰度（如 m3u8）的资源列出不同分辨率选项 |
| **自动命名规则** | 使用页面标题或视频标题作为文件名            |
| **批量下载**   | 支持勾选多个视频一次性下载               |
| **历史记录**   | 记录用户下载过的视频链接及时间             |
| **黑名单域名**  | 用户可设置不启用插件的视频网站列表           |

---

## 三、UI 设计

### 3.1 插件图标状态

| 状态   | 图标颜色 | 说明         |
| ---- | ---- | ---------- |
| 空闲   | 灰色   | 当前页面未检测到视频 |
| 发现视频 | 蓝色   | 检测到可下载视频资源 |
| 下载中  | 动态旋转 | 正在下载视频     |

### 3.2 弹出面板布局

```text
+-------------------------------------------+
| 🔍 检测到 3 个视频资源                    |
|-------------------------------------------|
| 🎬 video_1.mp4        [下载] [复制链接]   |
| 🎬 movie_1080p.m3u8   [下载] [复制链接]   |
| 🎬 ad_clip.mp4        [下载] [复制链接]   |
|-------------------------------------------|
| ⚙ 设置 | 📜 历史 | 🧾 帮助               |
+-------------------------------------------+
```

---

## 四、权限与安全

### 4.1 权限声明

插件需要以下权限：

* `activeTab`（访问当前网页）
* `downloads`（触发浏览器下载）
* `storage`（保存设置与历史记录）
* `webRequest`（拦截并分析网络请求）
* `clipboardWrite`（复制链接到剪贴板）

### 4.2 安全要求

* 不采集用户隐私数据
* 不上传视频内容或链接到远程服务器
* 符合 Chrome Web Store 隐私规范

---

## 五、技术实现

### 5.1 核心架构

* **background.js**：负责监听网络请求、匹配视频资源、与 content script 通信
* **content_script.js**：分析网页结构，提取 `<video>` 标签中的源信息
* **popup.html / popup.js**：显示视频列表、执行下载与复制操作
* **manifest.json**：定义插件信息与权限

### 5.2 主要逻辑流程

```text
用户打开网页
   ↓
content_script 检测 <video> 标签
   ↓
background 拦截网络请求 (webRequest)
   ↓
匹配视频类型 → 存入缓存
   ↓
用户点击插件图标
   ↓
popup.js 读取缓存 → 展示视频列表
   ↓
用户点击“下载” → 调用 downloads API
```

---

## 六、非功能性需求

| 类别       | 说明                        |
| -------- | ------------------------- |
| **性能**   | 检测延迟不超过 1 秒；UI 响应小于 100ms |
| **兼容性**  | 支持 Chrome 版本 100+         |
| **可扩展性** | 代码模块化，易于增加新格式支持           |
| **国际化**  | 默认支持中文与英文切换               |

---

## 七、未来优化方向

* 支持 YouTube、Bilibili 等常见平台（通过专用解析逻辑）
* 视频封面自动下载
* m3u8 视频自动合并为 MP4（需本地 JS 合并）
* 自定义保存目录

---

## 八、交付物

1. 插件源代码（`background.js`, `content_script.js`, `popup.html`, `popup.js`, `manifest.json`）
2. 图标素材（16px, 48px, 128px）
3. README（使用说明与安装步骤）
4. 隐私策略与发布文档（Chrome Web Store 版）